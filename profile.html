<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Politaria ‚Äì Profil</title>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="96x96" href="icon/favicon-96x96.png" />
  <link rel="icon" type="image/svg+xml" href="icon/favicon.svg" />
  <link rel="shortcut icon" href="icon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png" />
  <link rel="manifest" href="icon/site.webmanifest" />

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0b1020;
      --card: rgba(255,255,255,0.055);
      --card2: rgba(255,255,255,0.03);
      --border: rgba(148,163,184,0.16);
      --text:#e6edf3;
      --muted: rgba(230,237,243,0.70);
      --shadow: 0 24px 70px rgba(0,0,0,0.55);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 18% 10%, rgba(99,102,241,0.16), transparent 55%),
        radial-gradient(900px 500px at 85% 20%, rgba(34,211,238,0.14), transparent 58%),
        radial-gradient(900px 600px at 40% 90%, rgba(52,211,153,0.10), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    .stars{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:0.55;
      background-image:
        radial-gradient(2px 2px at 15% 25%, rgba(255,255,255,0.9) 40%, transparent 60%),
        radial-gradient(1px 1px at 45% 70%, rgba(255,255,255,0.7) 40%, transparent 60%),
        radial-gradient(1px 1px at 75% 35%, rgba(255,255,255,0.6) 40%, transparent 60%),
        radial-gradient(1px 1px at 85% 80%, rgba(255,255,255,0.55) 40%, transparent 60%),
        radial-gradient(2px 2px at 30% 85%, rgba(255,255,255,0.5) 40%, transparent 60%);
      filter: blur(0.1px);
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      padding:18px 26px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(148,163,184,0.12);
      background: rgba(10, 14, 26, 0.58);
      backdrop-filter: blur(10px);
      gap: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      user-select:none;
    }
    .brand-badge{
      width:38px;height:38px;border-radius:14px;overflow:hidden;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.14);
      display:flex;align-items:center;justify-content:center;
      box-shadow: 0 0 22px rgba(99,102,241,0.18), 0 0 22px rgba(34,211,238,0.12);
    }
    .brand-badge img{ width:74%; height:74%; object-fit:contain; display:block; }
    .brand-name{
      font-weight: 950;
      letter-spacing:0.2px;
      font-size:1.05rem;
      background: linear-gradient(90deg, #dbeafe, #a5b4fc, #67e8f9);
      -webkit-background-clip:text;
      color:transparent;
      text-shadow: 0 0 18px rgba(99,102,241,0.22);
    }

    .btn{
      border: 1px solid rgba(148,163,184,0.18);
      background: rgba(255,255,255,0.045);
      color: rgba(255,255,255,0.92);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 800;
      cursor: pointer;
      transition: 0.18s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(148,163,184,0.35); }
    .btn.primary{
      border:none;
      color:#071018;
      background: linear-gradient(135deg, rgba(96,165,250,0.95), rgba(34,211,238,0.88));
      box-shadow: 0 16px 44px rgba(37,99,235,0.18), 0 10px 34px rgba(34,211,238,0.16);
    }

    main{
      max-width: 1120px;
      margin: 0 auto;
      padding: 26px 18px 60px;
    }

    /* ====== HERO banner like Pax ====== */
    .hero{
      border-radius: 26px;
      overflow:hidden;
      border: 1px solid rgba(148,163,184,0.14);
      background:
        radial-gradient(1200px 360px at 20% 0%, rgba(168,85,247,0.22), transparent 60%),
        radial-gradient(1200px 360px at 80% 30%, rgba(34,211,238,0.18), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      box-shadow: var(--shadow);
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(800px 300px at 60% 120%, rgba(52,211,153,0.12), transparent 60%);
      opacity:0.9;
      pointer-events:none;
    }

    .hero-inner{
      position:relative;
      padding: 26px 22px 22px;
      display:flex;
      gap:22px;
      align-items:center;
      flex-wrap:wrap;
    }

    /* Avatar block */
    .avatar-wrap{
      width: 92px;
      height: 92px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
      box-shadow: 0 18px 50px rgba(0,0,0,0.35);
      position:relative;
    }
    .avatar-img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:none;
    }
    .avatar-fallback{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 950;
      font-size: 2.2rem;
      background: linear-gradient(180deg, rgba(249,115,22,0.95), rgba(239,68,68,0.88));
      color: rgba(255,255,255,0.96);
    }

    .avatar-tools{
      position:absolute;
      right: 8px;
      bottom: 8px;
      display:flex;
      gap:8px;
    }
    .icon-btn{
      width:32px;height:32px;border-radius:12px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(7,10,18,0.55);
      color: rgba(255,255,255,0.92);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: 0.15s ease;
      backdrop-filter: blur(10px);
    }
    .icon-btn:hover{ transform: translateY(-1px); border-color: rgba(148,163,184,0.38); }
    .avatar-tools input{ display:none; }

    /* Title block */
    .hero-title{
      min-width: 260px;
      flex: 1 1 auto;
    }
    .name{
      margin:0;
      font-size: clamp(1.9rem, 3.2vw, 3rem);
      font-weight: 950;
      letter-spacing: 0.2px;
      color: rgba(255,255,255,0.96);
      text-shadow: 0 18px 50px rgba(0,0,0,0.35);
    }
    .subline{
      margin-top: 6px;
      display:flex;
      flex-wrap:wrap;
      gap: 10px 10px;
      align-items:center;
      color: rgba(230,237,243,0.78);
      font-weight: 700;
      font-size: 0.98rem;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.18);
      background: rgba(255,255,255,0.04);
      font-weight: 850;
      color: rgba(230,237,243,0.88);
      white-space: nowrap;
    }

    .hero-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    /* ===== Stats grid ===== */
    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
      header{ padding: 16px 16px; }
    }

    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(600px 220px at 15% 0%, rgba(99,102,241,0.16), transparent 60%),
        radial-gradient(600px 220px at 85% 20%, rgba(34,211,238,0.12), transparent 60%);
      opacity:0.9;
      pointer-events:none;
    }
    .card > *{ position:relative; }

    .card-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 12px;
    }
    .card-title h2{
      margin:0;
      font-size:1.12rem;
      font-weight: 950;
      letter-spacing:0.2px;
    }
    .small{
      color: rgba(230,237,243,0.62);
      font-weight: 700;
      font-size: 0.92rem;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .stat{
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.14);
      background: rgba(255,255,255,0.03);
      padding: 14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .stat .k{
      color: rgba(230,237,243,0.78);
      font-weight: 850;
      letter-spacing:0.2px;
    }
    .stat .v{
      font-size: 1.6rem;
      font-weight: 950;
      color: rgba(255,255,255,0.95);
    }

    .note{
      margin-top: 12px;
      color: rgba(230,237,243,0.62);
      font-size: 0.92rem;
      line-height: 1.5;
    }
  </style>
</head>

<body>
  <div class="stars"></div>

  <header>
    <div class="brand">
      <div class="brand-badge">
        <img src="icon/favicon-96x96.png" alt="Politaria">
      </div>
      <div class="brand-name">Politaria</div>
    </div>

    <a class="btn" href="/games.html">‚Üê Retour</a>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="hero-inner">
        <div class="avatar-wrap">
          <img id="avatarImg" class="avatar-img" alt="Avatar">
          <div id="avatarFallback" class="avatar-fallback">U</div>

          <div class="avatar-tools">
            <label class="icon-btn" title="Changer (temporaire)">
              ‚úèÔ∏è
              <input id="avatarInput" type="file" accept="image/*">
            </label>
            <button class="icon-btn" id="avatarReset" title="Reset">‚Ü∫</button>
          </div>
        </div>

        <div class="hero-title">
          <h1 class="name" id="displayName">user0000</h1>

          <div class="subline">
            <span class="badge" id="badgeMode">üë§ Invit√©</span>
            <span class="badge" id="badgeEmail">üìß Invit√©</span>
            <span class="badge">üåç World</span>
            <span class="badge" id="badgeCheckins">üü£ 0 check-ins</span>
          </div>
        </div>

        <div class="hero-actions">
          <button class="btn primary" id="btnChangeName">Changer pseudo</button>
          <button class="btn" id="btnRandom">G√©n√©rer</button>
        </div>
      </div>
    </section>

    <!-- GRID -->
    <section class="grid">
      <div class="card">
        <div class="card-title">
          <h2>Player Stats</h2>
          <span class="small">Local</span>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">Games started</div>
            <div class="v" id="statGames">0</div>
          </div>
          <div class="stat">
            <div class="k">Rounds played</div>
            <div class="v" id="statRounds">0</div>
          </div>
        </div>

        <div class="note">Ces stats sont pr√™tes, mais tu les brancheras plus tard au vrai gameplay.</div>
      </div>

      <div class="card">
        <div class="card-title">
          <h2>Most Played Countries</h2>
          <span class="small">Top 8</span>
        </div>
        <div class="note">No country data yet.</div>
      </div>

      <div class="card">
        <div class="card-title">
          <h2>Creator Stats</h2>
          <span class="small">Local</span>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">Authored rounds</div>
            <div class="v" id="statAuthored">0</div>
          </div>
          <div class="stat">
            <div class="k">Preset copies</div>
            <div class="v" id="statCopies">0</div>
          </div>
        </div>

        <div class="note">Quand tu auras l‚Äô√©diteur/pr√©s√©lections, ces blocs prendront vie.</div>
      </div>

      <div class="card">
        <div class="card-title">
          <h2>AI Usage</h2>
          <span class="small">Local</span>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">Words in</div>
            <div class="v" id="statWordsIn">0</div>
          </div>
          <div class="stat">
            <div class="k">Words out</div>
            <div class="v" id="statWordsOut">0</div>
          </div>
        </div>

        <div class="note">Tu pourras incr√©menter ces valeurs quand tu activeras la g√©n√©ration d‚Äôunivers.</div>
      </div>
    </section>
  </main>

  <script>
    "use strict";

    // ===== Keys
    const MODE_KEY = "politariaMode";
    const EMAIL_KEY = "politariaEmail";
    const USERNAME_KEY = "politariaUsername";

    // Avatar: temporaire (session) + option persistance plus tard
    const AVATAR_TEMP_KEY = "politariaAvatarTemp"; // dataURL (temp)
    // (si un jour tu veux persister: localStorage.setItem("politariaAvatar", dataURL))

    // ===== DOM
    const avatarImg = document.getElementById("avatarImg");
    const avatarFallback = document.getElementById("avatarFallback");
    const avatarInput = document.getElementById("avatarInput");
    const avatarReset = document.getElementById("avatarReset");

    const displayName = document.getElementById("displayName");
    const badgeMode = document.getElementById("badgeMode");
    const badgeEmail = document.getElementById("badgeEmail");

    const btnChangeName = document.getElementById("btnChangeName");
    const btnRandom = document.getElementById("btnRandom");

    // ===== Utils
    function generateUsername(){
      const n = Math.floor(1000 + Math.random() * 9000);
      return "user" + n;
    }

    function normalizeName(s){
      return String(s || "")
        .trim()
        .toLowerCase()
        .replace(/\s+/g, "")
        .replace(/[^a-z0-9_]/g, "")
        .slice(0, 18);
    }

    function ensureUsername(){
      let u = localStorage.getItem(USERNAME_KEY);
      if(!u){
        u = generateUsername();
        localStorage.setItem(USERNAME_KEY, u);
      }
      return u;
    }

    function initialFromName(name){
      const s = String(name || "").trim();
      if(!s) return "U";
      const c = s[0].toUpperCase();
      return /[A-Z0-9]/.test(c) ? c : "U";
    }

    function setAvatarPreview(dataUrl){
      if(!dataUrl){
        avatarImg.style.display = "none";
        avatarFallback.style.display = "flex";
        avatarFallback.textContent = initialFromName(displayName.textContent);
        return;
      }
      avatarImg.src = dataUrl;
      avatarImg.style.display = "block";
      avatarFallback.style.display = "none";
    }

    function render(){
      const mode = localStorage.getItem(MODE_KEY) || "guest";
      const email = localStorage.getItem(EMAIL_KEY) || "";

      const username = ensureUsername();
      displayName.textContent = username;

      // Email: si rien => Invit√©
      if(email){
        badgeEmail.textContent = "üìß " + email;
      }else{
        badgeEmail.textContent = "üìß Invit√©";
      }

      badgeMode.textContent = mode === "google" ? "üü¢ Google" : "üë§ Invit√©";

      // Avatar temp (persist√© uniquement pour la session via sessionStorage)
      // ‚ö†Ô∏è Comme tu veux "temporairement", je mets sessionStorage.
      const temp = sessionStorage.getItem(AVATAR_TEMP_KEY);
      setAvatarPreview(temp);

      // fallback letter
      avatarFallback.textContent = initialFromName(username);
    }

    // ===== Avatar temp change
    avatarInput.addEventListener("change", () => {
      const file = avatarInput.files && avatarInput.files[0];
      if(!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = String(reader.result || "");
        // Temporaire => sessionStorage (dispara√Æt en fermant l‚Äôonglet)
        sessionStorage.setItem(AVATAR_TEMP_KEY, dataUrl);
        setAvatarPreview(dataUrl);
      };
      reader.readAsDataURL(file);
    });

    avatarReset.addEventListener("click", () => {
      sessionStorage.removeItem(AVATAR_TEMP_KEY);
      setAvatarPreview(null);
    });

    // ===== Pseudo
    btnRandom.addEventListener("click", () => {
      const u = generateUsername();
      localStorage.setItem(USERNAME_KEY, u);
      render();
    });

    btnChangeName.addEventListener("click", () => {
      const cur = localStorage.getItem(USERNAME_KEY) || "user0000";
      const next = prompt("Nouveau pseudo (a-z, 0-9, _ ; 3 √† 18 caract√®res) :", cur);
      if(next == null) return;

      const clean = normalizeName(next);
      if(!clean || clean.length < 3){
        alert("Pseudo invalide. (min 3 caract√®res) Autoris√©s : a-z, 0-9, _");
        return;
      }
      localStorage.setItem(USERNAME_KEY, clean);
      render();
    });

    render();
  </script>
</body>
</html>

